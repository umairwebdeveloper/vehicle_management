{% extends "base.html" %} {% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
        <li class="breadcrumb-item active" aria-current="page">Public Posts</li>
    </ol>
</nav>
<div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Public Posts</h3>
    <div>
        <a href="{% url 'forum:my_post' %}" class="btn btn-outline-secondary me-2"><i class="bi bi-box2"></i> My Posts</a>
        <a href="{% url 'forum:post_create' %}" class="btn btn-light border shadow-sm"> <i class="bi bi-plus-circle"></i> Create Post </a>
    </div>
</div>
<div class="mb-5">
    <form method="get" class="row g-3 mb-4">
        <div class="col-md-5">
            <input type="search" name="q" value="{{ request.GET.q }}" class="form-control" placeholder="Searchâ€¦" />
        </div>
        <div class="col-md-4">
            <select name="category" class="form-select">
                <option value="">All Categories</option>
                {% for value, label in categories %}
                    <option value="{{ value }}"{% if value == current_category %} selected{% endif %}>
                    {{ label }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <button type="submit" class="btn btn-light w-100"><i class="bi bi-search"></i> Filter</button>
        </div>
    </form>

    {% for post in posts %}
    <div class="card mb-3">
        <div class="card-body">
        <div class="d-flex align-items-center gap-2 mb-2">
            <h5 class="card-title mb-0">
            <p class="p-0 m-0">
                {{ post.title }}
            </p>
            </h5>

            {% if post.author == request.user %}
            <span class="badge bg-light text-dark border">You</span>
            {% endif %}
            {% if post.solved %}
            <span class="badge bg-light text-dark border">Solved</span>
            {% endif %}
        </div>

        <p class="card-text">
            {{ post.body }}
        </p>

        {# â€” Vehicle details box â€” #}
        {% if post.share_vehicle and post.vehicle %}
            <div class="border rounded p-3 mb-3 bg-light">
            <h6 class="mb-2">Vehicle Details</h6>
            <ul class="list-unstyled mb-0">
                <li><strong>Reg No:</strong> {{ post.vehicle.reg_number }}</li>
                <li><strong>Make:</strong> {{ post.vehicle.make }}</li>
                <li><strong>Model:</strong> {{ post.vehicle.model }}</li>
                <li><strong>Year:</strong> {{ post.vehicle.year }}</li>
                {% if post.vehicle.vin %}
                <li><strong>VIN:</strong> {{ post.vehicle.vin }}</li>
                {% endif %}
            </ul>
            </div>
        {% endif %}

        <div class="d-flex justify-content-between align-items-center">
            <small class="text-muted">
            By <strong>@{{ post.author.username }}</strong> â€¢ {{ post.created|date:"M d, Y h:i A" }}
            </small>

            <div class="d-flex align-items-center">
            <button
                type="button"
                class="btn btn-outline-secondary shadow-sm btn-sm reply-btn me-2"
                data-post-id="{{ post.pk }}"
                data-post-title="{{ post.title|escapejs }}"
            >
                ðŸ’¬ {{ post.reply_count }}
            </button>

            <a
                href="{% url 'forum:upvote' post.pk %}"
                class="btn shadow-sm btn-sm reply-btn me-2
                {% if post.is_liked %}
                    btn-secondary
                {% else %}
                    btn-outline-secondary
                {% endif %}"
            >
                {% if post.is_liked %}
                <i class="bi bi-hand-thumbs-up-fill"></i>
                {% else %}
                <i class="bi bi-hand-thumbs-up"></i>
                {% endif %}
                {{ post.upvote_count }}
            </a>

            {# â€” Edit button for author â€” #}
            {% if post.author == request.user %}
                <a
                href="{% url 'forum:post-edit' post.pk %}"
                class="btn btn-outline-secondary shadow-sm btn-sm reply-btn"
                >
                <i class="bi bi-pencil-square"></i> Edit
                </a>
            {% endif %}
            </div>
        </div>
        </div>
    </div>
    {% empty %}
    <p>No posts found.</p>
    {% endfor %}

    {% include "partials/_pagination.html" %}
</div>
<div class="modal fade" id="replyModal" tabindex="-1" aria-labelledby="replyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="replyModalLabel"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="replyModalBody">
                <!-- Loaded dynamically -->
            </div>
        </div>
    </div>
</div>
{% endblock %}{% block scripts %}
{% include "forum/posts_script.html" %}
{% endblock %}
