{# forum/templates/forum/ajax_replies.html #}

<h5 class="mb-3">Discussion on “{{ post.title }}”</h5>

<ul class="list-group mb-3">
    {# Top-level replies #}  {% for reply in top_replies %}
    <li class="list-group-item">
        <div class="d-flex justify-content-between">
            <strong>{{ reply.author.username }}</strong>
            <small class="text-muted">{{ reply.created|date:"M d, Y H:i" }}</small>
        </div>
        <p class="mb-1">{{ reply.body }}</p>
        {% if reply.is_solution %}
        <span class="badge bg-success">Solution</span>
        {% endif %} {# “Reply to this” button #}
        <button class="btn btn-sm btn-link reply-to-reply-btn" data-parent-id="{{ reply.pk }}">Reply</button>

        {# Nested children #} {% if reply.children.all %}
        <ul class="list-group ms-4 mt-2">
            {% for child in reply.children.all %}
            <li class="list-group-item">
                <div class="d-flex justify-content-between">
                    <strong>{{ child.author.username }}</strong>
                    <small class="text-muted">{{ child.created|date:"M d, Y H:i" }}</small>
                </div>
                <p class="mb-1">{{ child.body }}</p>
                {% if child.is_solution %}
                <span class="badge bg-success">Solution</span>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
        {% endif %}
    </li>
    {% empty %}
    <li class="list-group-item">No replies yet.</li>
    {% endfor %}
</ul>

<form id="modalReplyForm" method="post" action="{% url 'forum:post_replies' post.pk %}">
    {% csrf_token %} {{ reply_form.parent }} {# hidden input #}
    <div class="mb-3">{{ reply_form.body.label_tag }} {{ reply_form.body }}</div>
    <button type="submit" class="btn btn-primary">Send Reply</button>
</form>
